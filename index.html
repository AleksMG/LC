<!DOCTYPE html>
<html>
<head>
    <title>Математический шифратор</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 40px; }
        .container { max-width: 800px; margin: 0 auto; }
        textarea, input { width: 100%; margin: 10px 0; padding: 10px; }
        button { padding: 10px 20px; background: #007bff; color: white; border: none; cursor: pointer; }
        .row { display: flex; gap: 20px; margin: 20px 0; }
        .col { flex: 1; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Математический шифратор</h1>
        
        <div class="row">
            <div class="col">
                <h3>Алфавит (настраиваемый)</h3>
                <input type="text" id="alphabet" value="абвгдеёжзийклмнопрстуфхцчшщъыьэюяАБВГДЕЁЖЗИЙКЛМНОПРСТУФХЦЧШЩЪЫЬЭЮЯ .,!?-0123456789" placeholder="Введите символы алфавита">
            </div>
        </div>

        <div class="row">
            <div class="col">
                <h3>Пароль</h3>
                <input type="text" id="password" placeholder="Введите пароль">
            </div>
        </div>

        <div class="row">
            <div class="col">
                <h3>Исходный текст</h3>
                <textarea id="inputText" rows="6" placeholder="Введите текст для шифрования"></textarea>
                <button onclick="encrypt()">Зашифровать</button>
            </div>
            
            <div class="col">
                <h3>Результат</h3>
                <textarea id="outputText" rows="6" readonly placeholder="Результат появится здесь"></textarea>
                <button onclick="decrypt()">Расшифровать</button>
            </div>
        </div>
    </div>

    <script>
        class MathCipher {
            constructor(alphabet, password) {
                this.alphabet = alphabet;
                this.N = alphabet.length;
                this.key = this.generateKey(password);
                this.a = this.key[0] % this.N;
                this.b = this.key[1] % this.N;
            }
            
            generateKey(password) {
                let key = [];
                for (let i = 0; i < password.length; i++) {
                    const charCode = password.charCodeAt(i);
                    key.push((charCode * 13 + i * 7) % this.N);
                }
                return key;
            }
            
            charToNum(char) {
                const index = this.alphabet.indexOf(char);
                return index !== -1 ? index : 0;
            }
            
            numToChar(num) {
                return this.alphabet[num % this.N];
            }
            
            // Решение кубического уравнения для дешифрования
            solveCubic(c, a, b, N) {
                // Приведение к виду: x³ + px + q = 0
                const p = (3*b - a*a) / 3;
                const q = (2*a*a*a - 9*a*b + 27*c) / 27;
                
                // Дискриминант
                const D = (q*q/4) + (p*p*p/27);
                
                if (D >= 0) {
                    // Один вещественный корень
                    const u = Math.cbrt(-q/2 + Math.sqrt(D));
                    const v = Math.cbrt(-q/2 - Math.sqrt(D));
                    let x = (u + v) - a/3;
                    return Math.round(x) % N;
                } else {
                    // Три вещественных корня (используем первый)
                    const phi = Math.acos(-q/2 * Math.sqrt(-27/(p*p*p)));
                    let x = 2 * Math.sqrt(-p/3) * Math.cos(phi/3) - a/3;
                    return Math.round(x) % N;
                }
            }
            
            encrypt(text) {
                let result = '';
                for (let i = 0; i < text.length; i++) {
                    const P = this.charToNum(text[i]);
                    const K = this.key[i % this.key.length];
                    
                    // Нелинейное преобразование: C = (P³ + aP² + bP + K) mod N
                    const C = (P*P*P + this.a*P*P + this.b*P + K) % this.N;
                    
                    result += this.numToChar(C);
                }
                return result;
            }
            
            decrypt(text) {
                let result = '';
                for (let i = 0; i < text.length; i++) {
                    const C = this.charToNum(text[i]);
                    const K = this.key[i % this.key.length];
                    
                    // Решаем уравнение: P³ + aP² + bP + K ≡ C (mod N)
                    // Приводим к: P³ + aP² + bP + (K - C) ≡ 0 (mod N)
                    const constant = (K - C) % this.N;
                    
                    const P = this.solveCubic(constant, this.a, this.b, this.N);
                    result += this.numToChar(P);
                }
                return result;
            }
        }
        
        function encrypt() {
            const alphabet = document.getElementById('alphabet').value;
            const password = document.getElementById('password').value;
            const inputText = document.getElementById('inputText').value;
            
            if (!alphabet || !password) {
                alert('Заполните алфавит и пароль!');
                return;
            }
            
            const cipher = new MathCipher(alphabet, password);
            const encrypted = cipher.encrypt(inputText);
            document.getElementById('outputText').value = encrypted;
        }
        
        function decrypt() {
            const alphabet = document.getElementById('alphabet').value;
            const password = document.getElementById('password').value;
            const outputText = document.getElementById('outputText').value;
            
            if (!alphabet || !password) {
                alert('Заполните алфавит и пароль!');
                return;
            }
            
            const cipher = new MathCipher(alphabet, password);
            const decrypted = cipher.decrypt(outputText);
            document.getElementById('outputText').value = decrypted;
        }
    </script>
</body>
</html>
